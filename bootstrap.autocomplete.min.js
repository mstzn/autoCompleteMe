!function(e){var t=function(t,a){var n=t,s=!1,o=function(e){for(var t=-1,i=!1,s=e;s>0;s--){for(var o=n.val().substr(s-1,1),r=0;r<a.delimiters.length;r++){if(" "==o){u("space found"),i=!0;break}if(o==a.delimiters[r]){u("char found"),t=s;break}}if(t>-1||1==i)break}return u("delimiter index: "+t),t},r=function(){n.closest("div").find(".autoComplete").slideUp(100,function(){e(this).remove()})},l=function(){var e=n.get(0),t=0;if("selectionStart"in e)t=e.selectionStart;else if("selection"in document){e.focus();var a=document.selection.createRange(),i=document.selection.createRange().text.length;a.moveStart("character",-e.value.length),t=a.text.length-i}return t},c=function(){var e=l(),t=n.val(),a=n.val().length,s=[" ",".",",",";",":","-"];if(e==a)return e;for(i=e;i<a;i++)if(s.indexOf(t.substr(i,1)))return i;return-1},d=function(e,t){var a=n[0];if(a.setSelectionRange)a.focus(),a.setSelectionRange(e,t);else if(a.createTextRange){var i=a.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",e),i.select()}},m=function(t,i,s){if(s.length>0){var o="";if(s.length>0)for(item in s)o+=a.itemTemplate.replace("{isActive}",0==item?"active":"").replace("{username}",s[item].username).replace("{name}",s[item].name).replace("{image}",s[item].image).replace("{username_delimiter}",i+s[item].username);var l=e('<ul class="autoComplete dropdown-menu" style=""></ul>');""!=a.dropDownClass&&l.addClass(a.dropDownClass),l.append(o),n.closest("div").find(".autoComplete").slideUp(100,function(){e(this).remove()}),n.closest("div").append(l),n.closest("div").find(".autoComplete").slideDown(100)}else r()},u=function(e){1==a.debug&&console.log(e)};return n.on("keyup",function(t){var i,v=l(),f=n.val();if(u("Cursor:"+v),27!=t.which&&32!=t.which){if(13!=t.which)if(40!=t.which)if(38!=t.which){if(v>0&&(i=o(v),u(i),i>-1))if(v-i>a.minCharacter){var p=f.substr(i,v-i),h=f.substr(i-1,1);if(""!=p)if(u(h+"+"+p),""!=a.asyncAddress){if(s)return;s=!0,e.post(a.asyncAddress,{delimiter:h,query:p},function(e){m(0,h,e.data),s=!1},"json")}else{var C=[];for(idx in a.staticData)for(var g=0;g<a.queryBy.length;g++){u(a.queryBy[g]+"-"+p);var w=new RegExp(p,"g"+(a.sensitive?"":"i"));-1!=a.staticData[idx][a.queryBy[g]].search(w)&&(C.push(a.staticData[idx]),u(a.staticData[idx]))}m(0,h,C)}else r()}else r()}else e(".autoComplete").length>0&&e(".autoComplete").is(":visible")&&(t.preventDefault(),e(".autoComplete").find(".dropdown-item.active").prev().length>0?e(".autoComplete").find(".dropdown-item.active").removeClass("active").prev().addClass("active"):(e(".autoComplete").find(".dropdown-item.active").removeClass("active"),e(".autoComplete").find(".dropdown-item:last-child").addClass("active")));else e(".autoComplete").length>0&&e(".autoComplete").is(":visible")&&(t.preventDefault(),e(".autoComplete").find(".dropdown-item.active").next().length>0?e(".autoComplete").find(".dropdown-item.active").removeClass("active").next().addClass("active"):(e(".autoComplete").find(".dropdown-item.active").removeClass("active"),e(".autoComplete").find(".dropdown-item:first-child").addClass("active")));else if(e(".autoComplete").length>0&&e(".autoComplete").is(":visible")){t.preventDefault();var b=n.val(),x=c();if(-1!=x){i=o(v);var y=e(".autoComplete").find(".dropdown-item.active").data("value");u("item choosen: "+y),u("choosen delimiterIndex:"+i),u("choosen nextPost: "+x),n.val(b.substr(0,i)+y+b.substr(x-1,b.length-x-1));var D=i+y.length;d(D,D),r()}}}else r()}),n};e.fn.autoCompleteMe=function(a){var i={delimiters:["@"],debug:!1,sensitive:!0,queryBy:["name","username"],minCharacter:2,asyncAddress:!1,itemTemplate:'<li data-value="{username}" class="dropdown-item {isActive}"><a href="javascript:;"><img class="mention_image" src="{image}"><b class="mention_name">{name}</b><span class="mention_username">{username_delimiter}</span></a></li>',dropDownClass:"",staticData:[]};return i=e.extend({},i,a),this.each(function(){new t(e(this),i)})}}(jQuery);
